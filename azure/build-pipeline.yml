
trigger:
  - master
pr:
  - master

jobs:
  - job: "macOS"
    pool:
      vmimage: "macos-latest"
    steps:
      - task: Gradle@2
        inputs:
          workingDirectory: ''
          gradleWrapperFile: 'gradlew'
          gradleOptions: '-Xmx3072m'
          javaHomeOption: 'JDKVersion'
          jdkVersionOption: '1.8'
          jdkArchitectureOption: 'x64'
          publishJUnitResults: true
          testResultsFiles: '**/TEST-*.xml'
          tasks: 'build'

  - job: "Linux"
    pool:
      vmimage: "ubuntu-latest"
    steps:
      - task: Gradle@2
        inputs:
          workingDirectory: ''
          gradleWrapperFile: 'gradlew'
          gradleOptions: '-Xmx3072m'
          javaHomeOption: 'JDKVersion'
          jdkVersionOption: '1.8'
          jdkArchitectureOption: 'x64'
          publishJUnitResults: true
          testResultsFiles: '**/TEST-*.xml'
          tasks: 'publishLinuxMips32PublicationToMavenLocal publishLinuxMipsel32PublicationToMavenLocal linuxX64Test'

  - job: "Windows"
    pool:
      vmimage: "windows-latest"
    steps:
      - task: Gradle@2
        inputs:
          workingDirectory: ''
          gradleWrapperFile: 'gradlew'
          gradleOptions: '-Xmx3072m'
          javaHomeOption: 'JDKVersion'
          jdkVersionOption: '1.8'
          jdkArchitectureOption: 'x64'
          publishJUnitResults: true
          testResultsFiles: '**/TEST-*.xml'
          tasks: 'mingwX64Test publishMingwX86TestToMavenLocal'

  - job: "Sample"
    pool:
      vmimage: "macos-latest"
    steps:
      - task: Gradle@2
        displayName: 'Publish library to Maven Local for use by Sample'
        inputs:
          gradleWrapperFile: 'gradlew'
          tasks: 'publishToMavenLocal'
          gradleOptions: '-Xmx3072m'
          javaHomeOption: 'JDKVersion'
          jdkVersionOption: '1.8'
          jdkArchitectureOption: 'x64'
          publishJUnitResults: false
          sonarQubeRunAnalysis: false
      - task: Gradle@2
        displayName: 'Build Sample'
        inputs:
          gradleWrapperFile: 'KermitSample/gradlew'
          workingDirectory: 'KermitSample'
          options: '--build-cache'
          tasks: 'build'
          publishJUnitResults: true
          testResultsFiles: '**/TEST-*.xml'
          javaHomeOption: 'JDKVersion'
          sonarQubeRunAnalysis: false
      - task: Xcode@5
        displayName: 'Run sample with XCode'
        inputs:
          actions: 'build'
          configuration: 'Debug'
          sdk: 'iphoneos'
          xcWorkspacePath: 'KermitSample/KermitSampleIOS/KermitSampleIOS.xcworkspace'
          scheme: 'KermitSampleIOS'
          packageApp: false
          publishJUnitResults: false
